<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Familie Alders-Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-100">
    <div class="max-w-6xl mx-auto p-4 mt-4">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- LEFT COLUMN: Input & Members List -->
            <div class="space-y-6">
                <!-- Add Member Form -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Tilf칮j Familiemedlem</h2>
                    <form id="addMemberForm" class="space-y-4">
                        <input
                            type="text"
                            id="nameInput"
                            placeholder="Navn"
                            required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"
                        >
                        <div class="flex gap-4">
                            <input
                                type="date"
                                id="birthdayInput"
                                required
                                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"
                            >
                            <button
                                type="submit"
                                class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium"
                            >
                                Tilf칮j
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Family Members List -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Familiemedlemmer</h2>
                    <div id="membersList" class="space-y-3">
                        <p class="text-gray-500 text-center py-4">Ingen familiemedlemmer tilf칮jet endnu</p>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: Stats, Question & Milestones -->
            <div class="space-y-6">
                <!-- Live Counter -->
                <div class="bg-white rounded-xl shadow-md p-6 text-center">
                    <p class="text-gray-500 text-sm uppercase tracking-wide">Kombineret Alder (Live)</p>
                    <p id="liveYears" class="text-3xl font-bold text-purple-600 mt-2 font-mono">0.00000000</p>
                    <p class="text-gray-600">친r</p>
                </div>

                <!-- Combined Stats -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white rounded-xl shadow-md p-6 text-center">
                        <p class="text-gray-500 text-sm uppercase tracking-wide">Kombineret Alder</p>
                        <p id="combinedYears" class="text-4xl font-bold text-purple-600 mt-2">0</p>
                        <p class="text-gray-600">친r</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 text-center">
                        <p class="text-gray-500 text-sm uppercase tracking-wide">Kombineret Alder</p>
                        <p id="combinedDays" class="text-4xl font-bold text-purple-600 mt-2">0</p>
                        <p class="text-gray-600">dage</p>
                    </div>
                </div>

                <!-- Share Link -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-lg font-semibold text-gray-800">Del denne liste</h2>
                            <p class="text-sm text-gray-500">Opret et link til at dele med andre</p>
                        </div>
                        <button
                            onclick="generateShareLink()"
                            class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center gap-2"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                            </svg>
                            Kopier link
                        </button>
                    </div>
                    <div id="shareLinkResult" class="mt-3 hidden">
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg text-green-700 text-sm">
                            Link kopieret til udklipsholder!
                        </div>
                    </div>
                </div>

                <!-- Question Section -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Hvorn친r er vi X gamle?</h2>
                    <div class="flex gap-4 items-end">
                        <div class="flex-1">
                            <input
                                type="number"
                                id="targetValue"
                                placeholder="f.eks. 30000"
                                min="1"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"
                            >
                        </div>
                        <div>
                            <select
                                id="targetUnit"
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"
                            >
                                <option value="days">dage</option>
                                <option value="years">친r</option>
                            </select>
                        </div>
                        <button
                            onclick="calculateTarget()"
                            class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium"
                        >
                            Beregn
                        </button>
                    </div>
                    <div id="targetResult" class="mt-4 hidden">
                        <div class="p-4 bg-purple-50 border-l-4 border-purple-500 rounded-lg">
                            <p id="targetResultText" class="text-gray-800"></p>
                        </div>
                    </div>
                </div>

                <!-- Milestones -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Kommende Milep칝le</h2>
                    <div id="milestonesList" class="space-y-2">
                        <p class="text-gray-500 text-center py-4">Tilf칮j familiemedlemmer</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let familyMembers = JSON.parse(localStorage.getItem('familyMembers')) || [];

        // DOM elements
        const form = document.getElementById('addMemberForm');
        const nameInput = document.getElementById('nameInput');
        const birthdayInput = document.getElementById('birthdayInput');
        const membersList = document.getElementById('membersList');
        const combinedYearsEl = document.getElementById('combinedYears');
        const combinedDaysEl = document.getElementById('combinedDays');
        const milestonesList = document.getElementById('milestonesList');
        const liveYearsEl = document.getElementById('liveYears');

        // Calculate age in days
        function getAgeInDays(birthday) {
            const birth = new Date(birthday);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const diffTime = today - birth;
            return Math.floor(diffTime / (1000 * 60 * 60 * 24));
        }

        // Calculate age in years
        function getAgeInYears(birthday) {
            const birth = new Date(birthday);
            const today = new Date();
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        // Format date in Danish
        function formatDate(date) {
            const d = new Date(date);
            return d.toLocaleDateString('da-DK', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        // Format number with Danish formatting
        function formatNumber(num) {
            return num.toLocaleString('da-DK');
        }

        // Save to localStorage
        function saveData() {
            localStorage.setItem('familyMembers', JSON.stringify(familyMembers));
        }

        // Calculate precise age in years (with milliseconds)
        function getPreciseAgeInYears(birthday) {
            const birth = new Date(birthday);
            const now = new Date();
            const msPerYear = 365.25 * 24 * 60 * 60 * 1000;
            return (now - birth) / msPerYear;
        }

        // Update live counter
        function updateLiveCounter() {
            if (familyMembers.length === 0) {
                liveYearsEl.textContent = '0.00000000';
                return;
            }
            const totalYears = familyMembers.reduce((sum, m) => sum + getPreciseAgeInYears(m.birthday), 0);
            liveYearsEl.textContent = totalYears.toFixed(8);
        }

        // Generate shareable link
        function generateShareLink() {
            if (familyMembers.length === 0) {
                alert('Tilf칮j familiemedlemmer f칮rst');
                return;
            }
            const data = familyMembers.map(m => ({ n: m.name, b: m.birthday }));
            const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
            const url = window.location.origin + window.location.pathname + '#' + encoded;

            navigator.clipboard.writeText(url).then(() => {
                const resultDiv = document.getElementById('shareLinkResult');
                resultDiv.classList.remove('hidden');
                setTimeout(() => resultDiv.classList.add('hidden'), 3000);
            });
        }

        // Load from URL hash
        function loadFromHash() {
            const hash = window.location.hash.slice(1);
            if (hash) {
                try {
                    const decoded = decodeURIComponent(escape(atob(hash)));
                    const data = JSON.parse(decoded);
                    if (Array.isArray(data) && data.length > 0) {
                        familyMembers = data.map((m, i) => ({
                            id: Date.now() + i,
                            name: m.n,
                            birthday: m.b
                        }));
                        saveData();
                        window.history.replaceState(null, '', window.location.pathname);
                    }
                } catch (e) {
                    console.error('Failed to parse share link:', e);
                }
            }
        }

        // Calendar export functions
        function getDateParts(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return { year, month, day, dateStr: `${year}${month}${day}` };
        }

        function getEventDescription(title) {
            const names = familyMembers.map(m => m.name).join(', ');
            return `Familie milep칝l: ${title}\n\nFamiliemedlemmer: ${names}`;
        }

        function exportToGoogleCalendar(title, date) {
            const { year, month, day, dateStr } = getDateParts(date);
            const nextDay = new Date(date);
            nextDay.setDate(nextDay.getDate() + 1);
            const nextDayStr = `${nextDay.getFullYear()}${String(nextDay.getMonth() + 1).padStart(2, '0')}${String(nextDay.getDate()).padStart(2, '0')}`;

            const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${dateStr}/${nextDayStr}&details=${encodeURIComponent(getEventDescription(title))}`;
            window.open(url, '_blank');
        }

        function exportToOutlook(title, date) {
            const { year, month, day } = getDateParts(date);
            const dateFormatted = `${year}-${month}-${day}`;

            const url = `https://outlook.live.com/calendar/0/deeplink/compose?subject=${encodeURIComponent(title)}&startdt=${dateFormatted}&enddt=${dateFormatted}&body=${encodeURIComponent(getEventDescription(title))}&allday=true`;
            window.open(url, '_blank');
        }

        function exportToICS(title, date) {
            const { dateStr } = getDateParts(date);
            const description = getEventDescription(title).replace(/\n/g, '\\n');

            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Familie Alders-Tracker//DA',
                'BEGIN:VEVENT',
                `DTSTART;VALUE=DATE:${dateStr}`,
                `DTEND;VALUE=DATE:${dateStr}`,
                `SUMMARY:${title}`,
                `DESCRIPTION:${description}`,
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\r\n');

            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `milep칝l-${title.replace(/\s+/g, '-')}.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function toggleCalendarMenu(id) {
            const menu = document.getElementById(`cal-menu-${id}`);
            // Close all other menus
            document.querySelectorAll('[id^="cal-menu-"]').forEach(m => {
                if (m.id !== `cal-menu-${id}`) m.classList.add('hidden');
            });
            menu.classList.toggle('hidden');
        }

        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('[data-calendar-btn]') && !e.target.closest('[id^="cal-menu-"]')) {
                document.querySelectorAll('[id^="cal-menu-"]').forEach(m => m.classList.add('hidden'));
            }
        });

        // Add member
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const member = {
                id: Date.now(),
                name: nameInput.value.trim(),
                birthday: birthdayInput.value
            };
            familyMembers.push(member);
            saveData();
            render();
            form.reset();
            nameInput.focus();
        });

        // Remove member
        function removeMember(id) {
            familyMembers = familyMembers.filter(m => m.id !== id);
            saveData();
            render();
        }

        // Calculate target date
        function calculateTarget() {
            const targetValue = parseInt(document.getElementById('targetValue').value);
            const targetUnit = document.getElementById('targetUnit').value;
            const resultDiv = document.getElementById('targetResult');
            const resultText = document.getElementById('targetResultText');

            if (!targetValue || familyMembers.length === 0) {
                resultDiv.classList.add('hidden');
                return;
            }

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const totalDays = familyMembers.reduce((sum, m) => sum + getAgeInDays(m.birthday), 0);

            let targetDays;
            if (targetUnit === 'years') {
                targetDays = Math.ceil(targetValue * 365.25);
            } else {
                targetDays = targetValue;
            }

            const daysNeeded = targetDays - totalDays;
            const daysUntil = Math.ceil(daysNeeded / familyMembers.length);

            resultDiv.classList.remove('hidden');

            if (daysUntil <= 0) {
                const daysPassed = Math.abs(daysUntil);
                const pastDate = new Date(today);
                pastDate.setDate(pastDate.getDate() - daysPassed);
                resultText.innerHTML = `Vi n친ede <strong>${formatNumber(targetValue)} ${targetUnit === 'years' ? '친r' : 'dage'}</strong> den <strong>${formatDate(pastDate)}</strong> (for ${formatNumber(daysPassed)} dage siden)`;
            } else {
                const futureDate = new Date(today);
                futureDate.setDate(futureDate.getDate() + daysUntil);
                resultText.innerHTML = `Vi n친r <strong>${formatNumber(targetValue)} ${targetUnit === 'years' ? '친r' : 'dage'}</strong> den <strong>${formatDate(futureDate)}</strong> (om ${formatNumber(daysUntil)} dage)`;
            }
        }

        // Calculate family milestones
        function calculateMilestones() {
            if (familyMembers.length === 0) return [];

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const totalDays = familyMembers.reduce((sum, m) => sum + getAgeInDays(m.birthday), 0);
            const totalYears = Math.floor(totalDays / 365.25);

            const milestones = [];

            // Generate day milestones dynamically
            function getNextDayMilestones(currentDays, count = 5) {
                const result = [];
                // Find the next milestone based on current days
                let milestone;
                if (currentDays < 100000) {
                    // Every 10,000 up to 100,000
                    milestone = Math.ceil((currentDays + 1) / 10000) * 10000;
                } else if (currentDays < 1000000) {
                    // Every 50,000 up to 1,000,000
                    milestone = Math.ceil((currentDays + 1) / 50000) * 50000;
                } else {
                    // Every 100,000 after 1,000,000
                    milestone = Math.ceil((currentDays + 1) / 100000) * 100000;
                }

                while (result.length < count) {
                    result.push(milestone);
                    if (milestone < 100000) {
                        milestone += 10000;
                    } else if (milestone < 1000000) {
                        milestone += 50000;
                    } else {
                        milestone += 100000;
                    }
                }
                return result;
            }

            // Generate year milestones dynamically
            function getNextYearMilestones(currentYears, count = 5) {
                const result = [];
                let milestone;
                if (currentYears < 100) {
                    milestone = Math.ceil((currentYears + 1) / 25) * 25;
                    if (milestone === 0) milestone = 25;
                } else if (currentYears < 500) {
                    milestone = Math.ceil((currentYears + 1) / 50) * 50;
                } else if (currentYears < 2000) {
                    milestone = Math.ceil((currentYears + 1) / 100) * 100;
                } else {
                    milestone = Math.ceil((currentYears + 1) / 500) * 500;
                }

                while (result.length < count) {
                    result.push(milestone);
                    if (milestone < 100) {
                        milestone += 25;
                    } else if (milestone < 500) {
                        milestone += 50;
                    } else if (milestone < 2000) {
                        milestone += 100;
                    } else {
                        milestone += 500;
                    }
                }
                return result;
            }

            // Day milestones
            for (const days of getNextDayMilestones(totalDays)) {
                const daysNeeded = days - totalDays;
                const daysUntil = Math.ceil(daysNeeded / familyMembers.length);
                const milestoneDate = new Date(today);
                milestoneDate.setDate(milestoneDate.getDate() + daysUntil);
                milestones.push({
                    type: 'days',
                    value: days,
                    label: `${formatNumber(days)} dage`,
                    date: milestoneDate,
                    daysUntil
                });
            }

            // Year milestones
            for (const years of getNextYearMilestones(totalYears)) {
                const targetDays = Math.ceil(years * 365.25);
                const daysNeeded = targetDays - totalDays;
                const daysUntil = Math.ceil(daysNeeded / familyMembers.length);
                const milestoneDate = new Date(today);
                milestoneDate.setDate(milestoneDate.getDate() + daysUntil);
                milestones.push({
                    type: 'years',
                    value: years,
                    label: `${formatNumber(years)} 친r`,
                    date: milestoneDate,
                    daysUntil
                });
            }

            // Sort by days until and return top 8
            return milestones.sort((a, b) => a.daysUntil - b.daysUntil).slice(0, 8);
        }

        // Render everything
        function render() {
            // Render members list
            if (familyMembers.length === 0) {
                membersList.innerHTML = '<p class="text-gray-500 text-center py-4">Ingen familiemedlemmer tilf칮jet endnu</p>';
            } else {
                membersList.innerHTML = familyMembers.map(member => {
                    const days = getAgeInDays(member.birthday);
                    const years = getAgeInYears(member.birthday);
                    return `
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-medium text-gray-800">${member.name}</p>
                                <p class="text-sm text-gray-500">${formatDate(member.birthday)}</p>
                            </div>
                            <div class="text-right flex items-center gap-4">
                                <div>
                                    <p class="font-semibold text-purple-600">${years} 친r</p>
                                    <p class="text-sm text-gray-500">${formatNumber(days)} dage</p>
                                </div>
                                <button
                                    onclick="removeMember(${member.id})"
                                    class="text-red-500 hover:text-red-700 p-2"
                                    title="Fjern"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Calculate combined stats
            const totalDays = familyMembers.reduce((sum, m) => sum + getAgeInDays(m.birthday), 0);
            const totalYears = Math.floor(totalDays / 365.25);
            combinedYearsEl.textContent = formatNumber(totalYears);
            combinedDaysEl.textContent = formatNumber(totalDays);

            // Render milestones
            const milestones = calculateMilestones();
            if (milestones.length === 0) {
                milestonesList.innerHTML = '<p class="text-gray-500 text-center py-4">Tilf칮j familiemedlemmer</p>';
            } else {
                milestonesList.innerHTML = milestones.map((m, i) => `
                    <div class="flex items-center justify-between p-3 ${i === 0 ? 'bg-purple-50 border-l-4 border-purple-500' : 'bg-gray-50'} rounded-lg">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">${m.type === 'days' ? '游늰' : '游꾹'}</span>
                            <div>
                                <p class="font-semibold text-purple-600">${m.label}</p>
                                <p class="text-xs text-gray-500">${formatDate(m.date)} 췅 om ${formatNumber(m.daysUntil)} dage</p>
                            </div>
                        </div>
                        <div class="relative">
                            <button
                                data-calendar-btn
                                onclick="toggleCalendarMenu(${i})"
                                class="p-2 text-gray-400 hover:text-purple-600 hover:bg-purple-100 rounded-lg transition-colors"
                                title="Tilf칮j til kalender"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <div id="cal-menu-${i}" class="hidden absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-10 min-w-[160px]">
                                <button
                                    onclick="exportToGoogleCalendar('Familien: ${m.label}', '${m.date.toISOString()}')"
                                    class="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2"
                                >
                                    <svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                    Google Calendar
                                </button>
                                <button
                                    onclick="exportToOutlook('Familien: ${m.label}', '${m.date.toISOString()}')"
                                    class="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2"
                                >
                                    <svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="#0078D4" d="M24 7.387v10.478c0 .23-.08.424-.238.576-.16.154-.352.23-.578.23h-8.547v-6.959l1.703 1.278c.078.063.168.094.27.094.1 0 .19-.031.269-.094l6.884-5.156c.078-.062.144-.092.237-.092V7.387zm-.816-.957c0-.063-.016-.11-.047-.14-.032-.032-.063-.047-.094-.047h-.14l-7.266 5.454-2.5-1.875V3.386c0-.228-.08-.42-.237-.578-.156-.156-.35-.234-.578-.234H.816c-.228 0-.42.078-.578.234C.08 2.966 0 3.158 0 3.386v17.228c0 .228.08.422.238.578.158.156.35.234.578.234h11.281V10.71l11.087 8.308V6.43z"/></svg>
                                    Outlook
                                </button>
                                <button
                                    onclick="exportToICS('Familien: ${m.label}', '${m.date.toISOString()}')"
                                    class="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2"
                                >
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                                    Download .ics
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Load from share link if present
        loadFromHash();

        // Initial render
        render();

        // Start live counter (update every 50ms for smooth animation)
        updateLiveCounter();
        setInterval(updateLiveCounter, 50);

        // Update stats every minute
        setInterval(render, 60000);
    </script>
</body>
</html>
